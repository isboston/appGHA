name: Daily Notification

on:
  schedule:
    - cron: "0 11 * * *" # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 10:00 UTC

jobs:
  notify-failures:
    runs-on: ubuntu-latest
    steps:
      - name: Download failure log
        uses: actions/download-artifact@v3
        with:
          name: build_failures
          path: build_failures.log

      - name: Send aggregated notification
        run: |
          if [ -f build_failures.log ] && [ -s build_failures.log ]; then
            MESSAGE=$(cat build_failures.log)
            curl -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
              -H "Content-Type: application/json" \
              -d '{
                "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
                "parse_mode": "Markdown",
                "disable_web_page_preview": true,
                "text": "ðŸš¨ *Daily Build Failures Report*\n\n$MESSAGE"
              }'
            # ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³ Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
            > build_failures.log
          else
            echo "No failures to report."
          fi
